{% extends "main/base.html" %}

{% block content %}
    <b-row align-v="center" class="mb-5">
        <b-col cols="auto">
            {% if user.profile.image.url %}
                <img class="rounded-circle account-img" src="{{ user.profile.image.url }}">
            {% else %}
                <img class="rounded-circle account-img" src="/media/default.png">
            {% endif %}
        </b-col>
        <b-col>
            <b-row>
                <b-col>
                    <h3>{{ user.username }}</h3>
                </b-col>
            </b-row>
            {% if user.email %}
                <b-row>
                    <b-col>
                        <h6 class="text-muted">({{ user.email }})</h6>
                    </b-col>
                </b-row>
            {% endif %}
            <b-row>
                <b-col>
                    <small class="text-muted">Joined on: {{ user.date_joined }}</small>
                </b-col>
            </b-row>
        </b-col>
    </b-row>
    <b-tabs v-model="tabIndex" content-class="mt-5">
        <b-tab>
            <template v-slot:title>
                <h5><span class="mdi mdi-clipboard-list mr-2"></span>Order History</h5>
            </template>
            {% if orderhistory%}
                {% for order in orderhistory %}
                    <p>{{order.title}}</p>
                {% endfor %}
            {% else %}
                <p class="text-muted">You don't have any order history yet.</p>
            {% endif %}
        </b-tab>
        <b-tab>
            <template v-slot:title>
                <h5><span class="mdi mdi-warehouse mr-2"></span>My Warehouse</h5>
            </template>
            <b-col>
                <b-row class="mb-3">
                    {% if inventory %}
                        {% for item in inventory %}
                            <p>{{item.title}}</p>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">You don't have anything to sell yet... Add some by clicking the button below!</p>
                    {% endif %}
                </b-row>
                <b-row>
                    <b-col>
                        <b-row>
                            <b-button @click="createModal = true">Add new listing</b-button>
                            <add-product v-model="createModal" />
                        </b-row>
                    </b-col>
                </b-row>
            </b-col>
        </b-tab>
    </b-tabs>
{% endblock content %}

{% block js %}
    {% include "auction/add_product.js" %}
{% endblock %}

{% block vue %}
data: {
    createModal: false,
    tabIndex: {{ tabIndex }},
},
watch: {
    tabIndex(newVal) {
        const action = newVal === 1 ? 'listings' : 'orders';
        window.history.pushState(null, null, `${window.location.origin}/user/profile/${action}`);
    }
},
{% endblock %}
